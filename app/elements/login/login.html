<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/firebase-element/firebase-auth.html">
<link rel="import" href="../shared-styles/shared-styles.html">
<link rel="import" href="chat.html">
<dom-module id="e-login">
  <template>
    <style>
      :host{
        display: block;
        overflow: auto;
        height: 100%;
        @apply(--normal-text);
      }
      .fit{
        @apply(--layout-fit);
        @apply(--layout-horizontal);
        @apply(--layout-center-justified);
        @apply(--layout-center);
        background: var(--grey-alpha);
      }
      button {
        padding-left: 35px;
        padding-right: 0px;
        height: 35px;
        background: none;
        border: none;
        display: block;
        background-size: 25px 25px, cover;
        background-position: 10px center, center center;
        background-repeat: no-repeat, repeat;
        border-radius: 4px;
        color: white;
        font-family:"Merriweather Sans", sans-serif;
        font-size: 14px;
        margin: 15px auto;
        width: 205px;
        border-bottom: 2px solid transparent;
        border-left: 1px solid transparent;
        border-right: 1px solid transparent;
        box-shadow: 0 4px 2px -2px gray;
        text-shadow: rgba(0, 0, 0, .4) -1px -1px 0;
      }

 .googleplus {
    background-size: 30px 30px, cover;
    background-image: url(gplus.png), -webkit-gradient(linear, left top, left bottom, color-stop(1%, #FF2E74), color-stop(100%, #CE1471));
    ;
}
 .facebook {
    background: url(facebookf.png), -webkit-gradient(linear, left top, left bottom, color-stop(0%, #4c74c4), color-stop(100%, #3b5998));
    background-size: 25px 25px, cover;
    background-position: 10px center, center center;
    background-repeat: no-repeat, repeat;
}
 .twitter {
    background-image: url(twitterbird.png), -webkit-gradient(linear, left top, left bottom, color-stop(1%, #00aced), color-stop(99%, #00a9ff));
}

    .app{
        @apply(--layout-vertical);
        overflow: hidden;
        background: #ecf0f1;
    }
    .app {
        height: 100%;
    }
    .app .chat{
      height: 84%;
      max-width: 600px;
      margin: 0 auto;
    }
    .loginMenu{
      height: 16%;
    }
    e-chat{
      height: 100%;
      }
      .social-wrap{ max-width: 600px; text-align: center; color: var(--grey-bbb); }


    </style>
    <firebase-auth id="firebaseLogin" params='{{params}}' user="{{user}}" status-known="{{statusKnown}}" location="https://sounak.firebaseio.com/" provider="{{provider}}" on-error="errorHandler" on-login="userSuccessHandler"></firebase-auth>


    <template is="dom-if" if="{{computeLogoutHidden(statusKnown, user)}}">
      <div class="fit">
        <div class="social-wrap c">
          <h1>Hi, please login to let me know you were here. No spams :)</h1>
          <button on-click="login" class="facebook" value="facebook">Sign in with Facebook</button>
          <button on-click="login" class="twitter" value="twitter">Sign in with Twitter</button>
          <button on-click="login" class="googleplus" value="google">Sign in with Google</button>
        </div>
      </div>
    </template>

    <template is="dom-if" if="{{computeLoginHidden(statusKnown, user)}}">
      <div class="app">
        <div class="loginMenu">

          <div><span>Contact</span></div>
          <div class="photo">
            <div class="text"><em>
              <div class="typo">hi folks, thanks for coming this far.</div>
              <div class="typo">Post a comment on the right
              :)<span>|</span></div></em>
            </div>
          </div>
          <div class="links">
            <a href=""><span>Resume</span></a>
            <a href=""><span>Download</span> CV</a>
            <a on-tap="logout" style="border:0"><span>Logout</span></a>
          </div>
        </div>
        <div class="chat">
          <e-chat user="{{user}}"></e-chat>
        </div>
      </div>
    </template>

  </template>
</dom-module>
<script>

      var ref = new Firebase('https://sounak.firebaseio.com/');
  Polymer({
    is: 'e-login',

    properties: {

      fireAdd:{
        type: String,
        value: ''
      },

      provider: {
        type: String
      },

      message: {
        type: String,
        value: ''
      },

      user: {
        type: Object,
        value: null
      },

      reference: {
        type: Object,
        value: null
      },

      statusKnown: {
        type: Boolean
      }
    },

    login: function(e) {
      var params;

      try {
        params = JSON.parse(this.params);
      } catch (e) {
        params = null;
      }
      console.log(e.srcElement.value);
      this.provider = e.srcElement.value;

      this.$.firebaseLogin.login();
    },

    logout: function() {
      this.$.firebaseLogin.logout();
    },

    errorHandler: function(e) {
      this.message = 'Error: ' + e.detail.message;
    },

    userSuccessHandler: function(e) {
      console.log(e);
      if(!this.user){
        return;
      }
      var usersRef = ref.child('users');
      var uid = e.detail.user.uid;
      usersRef.child(uid).update({
          'full_name': e.detail.user.facebook.displayName,
          'email': e.detail.user.facebook.email,
          'photo':e.detail.user.facebook.profileImageURL
        });
      this.message = e.type + ' success!';
    },

    computeLoginHidden: function(statusKnown, user) {
      return !statusKnown || !!user;
    },

    computeLogoutHidden: function(statusKnown, user) {
      return !statusKnown || !user;
    },

    computeLoginStatus: function(statusKnown, user) {
      if (statusKnown && user) {
        return 'Logged in';
      }

      if (statusKnown) {
        return 'Logged out';
      }

      return 'Unknown (checking status...)';
    }





  });
</script>
